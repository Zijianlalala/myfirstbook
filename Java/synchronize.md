# 同步相关
有关多线程的问题

## `sleep`和`wait`的区别
`sleep`是使当前运行的线程停止执行指定的时间，该线程不会放弃任何管程的拥有权。

`wait`是使当前运行的线程等待，直到其他的线程调用这个对象的`notifyAll()`或者`notify()`方法；或者中断此线程；或者等待超过指定的时间。总之，`wait`和`notify`用于多线程协调运行。

另外使用`wait`时值得注意的几点
1. 使用`wait`之前的判断条件要用`while(condition)`而非`if(condition)`，因为线程会偶尔从等待状态激活，也就是需要再次获得`this`锁
2. 获得到同步锁后需要再检查一遍条件，因为条件的数量有限，可能会别的线程用掉。
3. 在调用`wait`和`notify`之前，必须拥有锁，当一个线程在`this.wait()`上等待时，它就会释放`this`锁。

## i++是线程不安全的操作
测试了两个线程的同时写的情况不会出错，测试100个线程对同一变量同时进行i++操作时，会出错。

出错的原因是`i++`这条语句不具备原子性。
```
getfield // 读取变量
iadd // 加1
putfield // 写回变量
```
应该将这三条语句上锁，才能解决。